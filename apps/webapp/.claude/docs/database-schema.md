# Database Schema

## Directory Structure

```
src/db/
├── auth-schema.ts           # DO NOT EDIT - Auto-generated by Better Auth
├── schema.ts                # Re-export barrel for backward compatibility
└── schema/
    ├── index.ts             # Main barrel file
    ├── enums.ts             # All pgEnum definitions
    ├── types.ts             # TypeScript type definitions
    ├── relations.ts         # ALL relation definitions (centralized)
    ├── organization.ts      # team, location, employee, employeeManagers
    ├── work-schedule.ts     # workScheduleTemplate, workScheduleTemplateDays
    ├── holiday.ts           # holidayCategory, holiday, holidayPreset
    ├── shift.ts             # shiftTemplate, shift, shiftRequest
    ├── project.ts           # project, projectManager, projectAssignment
    ├── time-tracking.ts     # timeEntry, workPeriod
    ├── absence.ts           # absenceCategory, absenceEntry
    ├── vacation.ts          # vacationAllowance, employeeVacationAllowance
    ├── time-regulation.ts   # timeRegulation, timeRegulationBreakRule
    ├── surcharge.ts         # surchargeModel, surchargeRule
    ├── approval.ts          # approvalRequest
    ├── notification.ts      # notification, notificationPreference, pushSubscription
    ├── audit.ts             # auditLog
    ├── enterprise.ts        # organizationDomain, organizationBranding
    ├── export.ts            # dataExport, exportStorageConfig
    ├── wellness.ts          # waterIntakeLog, hydrationStats
    ├── user-settings.ts     # userSettings
    └── system.ts            # systemConfig
```

## Import Pattern

```typescript
import { employee, team, workPeriod } from "@/db/schema";
```

## Adding New Tables

1. Choose the appropriate domain file (or create new one)
2. Define the table
3. Add relations to `schema/relations.ts`
4. Export from `schema/index.ts` if new file
5. Run `pnpm drizzle-kit push`

## Why Centralized Relations?

Relations are in a single `relations.ts` to avoid circular imports. Drizzle relations require object references - if co-located, circular imports occur (employee → team → employee).

---

# User Settings Pattern

## userSettings vs User table

**userSettings table** (in `src/db/schema.ts`):
- User preferences NOT part of authentication
- UI/UX preferences (dashboard layout, theme)
- Feature settings (notification intervals, widget order)
- Frequently changing data

**User table** (via Better Auth):
- Core identity (name, email, image)
- Authentication fields
- Permissions and roles
- Fields needed during auth flow

## Adding New Preferences

1. Define a typed interface
2. Add column: `text("column_name").$type<YourType>()`
3. Add server actions
4. Add query keys to `src/lib/query/keys.ts`
