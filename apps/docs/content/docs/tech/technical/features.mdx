---
title: Features & Compliance
description: Blockchain verification, time regulations, export system, and avatars
icon: Server
---

## Blockchain Verification

### GoBD Compliance

Time entries are secured using blockchain-style hashing for GoBD (German record-keeping) compliance:

- Each time entry receives a SHA-256 hash
- Hashes chain together for tamper detection
- Full audit trail with integrity verification

### Hash Calculation

```typescript
import { calculateBlockchainHash } from '@/lib/blockchain';

const hash = calculateBlockchainHash({
  previousHash: entry.previousHash,
  timestamp: entry.createdAt,
  data: entry.data,
});
```

### Validation

```typescript
import { validateBlockchainIntegrity } from '@/lib/blockchain';

const isValid = await validateBlockchainIntegrity(entries);
```

---

## Work Policy Service

The Work Policy Service provides unified management of work schedules and time regulations.

### Policy Resolution

Resolves the effective policy for an employee using hierarchical inheritance:

```typescript
import { WorkPolicyService } from '@/lib/effect/services/work-policy.service';

// Get effective policy for an employee
const policy = await WorkPolicyService.getEffectivePolicy({
  employeeId,
  organizationId,
});
// Returns: Employee policy → Team policy → Organization default
```

### Schedule Validation

```typescript
// Validate expected vs actual hours
const result = await WorkPolicyService.validateSchedule({
  employeeId,
  date,
  actualHours: 8.5,
});
// Returns: { expected: 8, actual: 8.5, variance: 0.5 }
```

### Labor Law Compliance

```typescript
// Validate work period against regulations
const result = await WorkPolicyService.validateWorkPeriod({
  employeeId,
  startTime,
  endTime,
  breaks,
});
```

### Break Rules

Break rules are configured per policy:

```typescript
interface BreakRule {
  afterHours: number;  // Hours threshold
  minBreakMinutes: number;  // Required break duration
}
```

### Compliance Validation

```typescript
// Check compliance for a date range
const violations = await WorkPolicyService.checkCompliance({
  employeeId,
  startDate,
  endDate,
});
```

---

## Change Policy Service

The Change Policy Service manages time entry modification rules.

### Policy Resolution

```typescript
import { ChangePolicyService } from '@/lib/effect/services/change-policy.service';

// Get effective change policy
const policy = await ChangePolicyService.getEffectivePolicy({
  employeeId,
  organizationId,
});
```

### Edit Permission Check

```typescript
// Check if an entry can be edited
const canEdit = await ChangePolicyService.canEditEntry({
  employeeId,
  entryDate,
  policy,
});
// Returns: { allowed: true, requiresApproval: false }
//      or: { allowed: true, requiresApproval: true }
//      or: { allowed: false, reason: 'Entry too old' }
```

### Trust Mode

```typescript
// Check if approval is required
if (policy.noApprovalRequired) {
  // Auto-approve all changes
} else {
  // Check self-service window
  const withinWindow = isWithinDays(entryDate, policy.selfServiceDays);
}
```

---

## Work Category Service

The Work Category Service manages work categorization and time factors.

### Category Set Resolution

```typescript
import { WorkCategoryService } from '@/lib/effect/services/work-category.service';

// Get available categories for an employee
const categories = await WorkCategoryService.getCategories({
  employeeId,
  organizationId,
});
```

### Time Factor Calculation

```typescript
// Calculate adjusted hours
const adjustedHours = await WorkCategoryService.calculateAdjustedHours({
  actualHours: 4,
  categoryId, // e.g., "overtime" with 1.5x factor
});
// Returns: 6 (4 * 1.5)
```

### Category Assignment

```typescript
// Assign category to time entry
await WorkCategoryService.assignCategory({
  timeEntryId,
  categoryId,
});
```

---

## Export System

### Export Service

The export service handles asynchronous data exports:

```typescript
import { ExportService } from '@/lib/export/export-service';

// Create export job
const job = await ExportService.createExport({
  types: ['employees', 'timeEntries'],
  format: 'csv',
  dateRange: { start, end },
});
```

### Formatters

Multiple export formats are supported:

```
src/lib/export/formatters/
├── csv-formatter.ts   # CSV output
├── json-formatter.ts  # JSON output
└── zip-builder.ts     # ZIP archive creation
```

### Storage Integration

Exports can be stored in S3-compatible storage:

```typescript
import { ExportS3Client } from '@/lib/storage/export-s3-client';

await ExportS3Client.upload(exportBuffer, filename);
```

---

## Avatar Generation

### DiceBear Integration

User avatars are generated using DiceBear:

```typescript
import { generateAvatar } from '@/lib/avatar';

// Generate avatar URL from seed (e.g., user ID or email)
const avatarUrl = generateAvatar(userId, {
  style: 'initials',
  backgroundColor: ['b6e3f4', 'c0aede'],
});
```

### Avatar Styles

Available styles:
- `initials` - Letter-based avatars
- `avataaars` - Cartoon-style avatars
- `bottts` - Robot avatars
- `identicon` - Geometric patterns

---

## Demo Data Generation

### Employee Generator

Generate realistic demo employees:

```typescript
import { EmployeeGenerator } from '@/lib/demo/employee-generator';

const employees = EmployeeGenerator.generate(count, {
  includeManagers: true,
  locale: 'de',
});
```

### Demo Data Service

Full demo data generation:

```typescript
import { DemoDataService } from '@/lib/demo/demo-data.service';

await DemoDataService.seed({
  employees: 50,
  timeEntries: true,
  absences: true,
  dateRange: { months: 6 },
});
```
