---
title: Services & Infrastructure
description: Notifications, storage, background jobs, analytics, and DateTime handling
icon: Cloud
---

import { Tabs, Tab } from 'fumadocs-ui/components/tabs';
import { Callout } from 'fumadocs-ui/components/callout';
import { File, Folder, Files } from 'fumadocs-ui/components/files';

## Notification System

### Multi-Channel Architecture

The notification system supports three delivery channels:

| Channel | Technology | Use Case |
|---------|------------|----------|
| **Email** | SMTP / Provider | Transactional emails |
| **Push** | Web Push API | Browser notifications |
| **In-App** | Server-Sent Events | Real-time updates |

### Push Notifications

<Tabs items={['Generate Keys', 'Configure']}>
  <Tab value="Generate Keys">
    ```bash
    bunx web-push generate-vapid-keys
    ```
  </Tab>
  <Tab value="Configure">
    ```ini
    VAPID_PUBLIC_KEY=<generated-public-key>
    VAPID_PRIVATE_KEY=<generated-private-key>
    VAPID_SUBJECT=mailto:support@yourdomain.com
    ```
  </Tab>
</Tabs>

### SSE Implementation

Real-time notifications use Server-Sent Events:
- Endpoint: `/api/notifications/sse`
- Auto-reconnection on disconnect
- Event types: `notification`, `status`, `heartbeat`

---

## Storage Infrastructure

### TUS Resumable Uploads

File uploads use the TUS protocol for reliable, resumable uploads:

- Large file support with chunking
- Resume interrupted uploads
- Progress tracking

### S3 Integration

Configure S3-compatible storage:

```ini
S3_BUCKET=your-bucket
S3_REGION=eu-central-1
S3_ACCESS_KEY_ID=<access-key>
S3_SECRET_ACCESS_KEY=<secret-key>
S3_ENDPOINT=https://s3.amazonaws.com  # Or compatible endpoint
```

---

## Background Jobs

### Cron Jobs

Background jobs are handled via cron endpoints:

| Job | Schedule | Description |
|-----|----------|-------------|
| `/api/cron/reminders` | Daily | Clock in/out reminders |
| `/api/cron/reports` | Weekly | Scheduled report generation |
| `/api/cron/cleanup` | Daily | Cleanup expired data |
| `/api/cron/export` | On-demand | Data export processing |

### Job Processing

```typescript
import { processExportJob } from '@/lib/jobs/export-processor';
```

---

## DateTime Handling

### Luxon Integration

All date/time operations use Luxon for timezone-aware handling:

<Tabs items={['Create', 'Format', 'Convert']}>
  <Tab value="Create">
    ```typescript
    import { DateTime } from 'luxon';

    // Create with timezone
    const dt = DateTime.now().setZone('Europe/Berlin');
    ```
  </Tab>
  <Tab value="Format">
    ```typescript
    // Format for display
    dt.toFormat('dd.MM.yyyy HH:mm');

    // ISO format for API
    dt.toISO();
    ```
  </Tab>
  <Tab value="Convert">
    ```typescript
    // Convert to user's timezone
    toLocalTime(date, userTimezone);

    // Convert to UTC for storage
    toUTC(date);
    ```
  </Tab>
</Tabs>

### Utilities

Custom utilities in `src/lib/datetime/`:
- `toLocalTime()` - Convert to user's timezone
- `toUTC()` - Convert to UTC for storage
- `formatDuration()` - Human-readable duration
- `getWorkingDays()` - Calculate business days

---

## Email Templates

### React Email

Email templates use React Email for consistent styling:

<Files>
  <Folder name="src/lib/email/templates" defaultOpen>
    <File name="welcome.tsx" />
    <File name="approval-request.tsx" />
    <File name="approval-response.tsx" />
    <File name="time-reminder.tsx" />
    <File name="export-ready.tsx" />
    <File name="export-failed.tsx" />
  </Folder>
</Files>

### Rendering

```typescript
import { render } from '@/lib/email/render';
import { WelcomeEmail } from '@/lib/email/templates/welcome';

const html = await render(WelcomeEmail, { name: 'John' });
```

---

## Analytics Service

### Team Performance Metrics

The analytics service provides:

- Work hours by team/employee
- Overtime trends and patterns
- Vacation usage and balance
- Attendance metrics

### API Endpoints

| Endpoint | Description |
|----------|-------------|
| `GET /api/analytics/team-performance` | Team performance metrics |
| `GET /api/analytics/vacation-trends` | Vacation usage trends |
| `GET /api/analytics/work-hours` | Work hours summary |
| `GET /api/analytics/export` | Export analytics data |
