---
title: Database Schema
description: Core tables, schema generation, and Drizzle ORM configuration
icon: Database
---

## Core Tables

The database uses Drizzle ORM with the following key entities:

- **users** - Authentication and user accounts
- **employees** - Employee profiles linked to users
- **organizations** - Multi-tenant organization support
- **teams** - Team structure and membership
- **locations** - Physical work locations
- **time_entries** - Clock in/out records
- **absences** - Vacation and time-off requests
- **holidays** - Public and custom holidays
- **holiday_presets** - Reusable holiday collections
- **vacation_assignments** - Flexible vacation allocation rules
- **notifications** - Multi-channel notification records
- **push_subscriptions** - Browser push notification subscriptions
- **audit_logs** - Comprehensive audit trail

---

## Schema Modularization

The database schema is organized into domain-specific modules for maintainability:

```
src/db/schema/
├── index.ts              # Re-exports all schemas
├── auth.ts               # Authentication (users, sessions, accounts)
├── organization.ts       # Organizations, members, invitations
├── employee.ts           # Employee profiles, positions
├── team.ts               # Teams, team members
├── location.ts           # Work locations
├── time-entry.ts         # Clock in/out records
├── absence.ts            # Vacation, sick leave requests
├── holiday.ts            # Holidays, holiday presets
├── vacation.ts           # Vacation assignments, balances
├── work-policy.ts        # Work policies (schedules + regulations)
├── work-category.ts      # Work category sets and categories
├── change-policy.ts      # Time entry change policies
├── employee-rate.ts      # Employee rate history
├── project.ts            # Projects, project assignments
├── surcharge.ts          # Surcharges, surcharge rules
├── notification.ts       # Notifications, push subscriptions
├── audit.ts              # Audit logs
├── export.ts             # Export jobs, export files
├── payroll-export.ts     # Payroll export config, jobs, sync records
└── ... (26+ domain files)
```

### Key Tables

| Table | Description |
|-------|-------------|
| `work_policy` | Unified work schedules and regulations |
| `work_category` | Work categories with time factors |
| `work_category_set` | Sets of categories for assignment |
| `change_policy` | Time entry modification policies |
| `employee_rate_history` | Hourly rate tracking over time |
| `payroll_export_config` | Payroll export format configuration |
| `payroll_wage_type_mapping` | Wage type mappings with format-specific codes |
| `payroll_export_job` | Export job tracking with status |
| `payroll_export_sync_record` | Individual record sync status for API exports |

---

## Schema Generation

```bash
# Generate Better-Auth schema
bunx --bun @better-auth/cli generate --output ./src/db/schema.ts

# Run database migrations
bun db:migrate
```

---

## New Tables Reference

### work_policy

```sql
CREATE TABLE work_policy (
  id UUID PRIMARY KEY,
  organization_id UUID REFERENCES organization(id),
  name TEXT NOT NULL,
  schedule_enabled BOOLEAN DEFAULT true,
  regulation_enabled BOOLEAN DEFAULT true,
  schedule_type TEXT, -- 'simple' | 'detailed'
  weekly_hours DECIMAL,
  daily_hours JSONB, -- { monday: 8, tuesday: 8, ... }
  max_daily_hours DECIMAL,
  max_weekly_hours DECIMAL,
  break_rules JSONB, -- [{ afterHours: 6, minBreakMinutes: 30 }]
  created_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ
);
```

### work_category

```sql
CREATE TABLE work_category (
  id UUID PRIMARY KEY,
  set_id UUID REFERENCES work_category_set(id),
  name TEXT NOT NULL,
  time_factor DECIMAL DEFAULT 1.0,
  color TEXT,
  sort_order INTEGER,
  created_at TIMESTAMPTZ
);
```

### change_policy

```sql
CREATE TABLE change_policy (
  id UUID PRIMARY KEY,
  organization_id UUID REFERENCES organization(id),
  name TEXT NOT NULL,
  self_service_days INTEGER DEFAULT 3,
  approval_days INTEGER DEFAULT 30,
  no_approval_required BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ
);
```

### employee_rate_history

```sql
CREATE TABLE employee_rate_history (
  id UUID PRIMARY KEY,
  employee_id UUID REFERENCES employee(id),
  hourly_rate DECIMAL NOT NULL,
  currency TEXT DEFAULT 'EUR',
  effective_from DATE NOT NULL,
  created_by UUID REFERENCES user(id),
  created_at TIMESTAMPTZ
);
```

### payroll_export_config

```sql
CREATE TABLE payroll_export_config (
  id UUID PRIMARY KEY,
  organization_id TEXT REFERENCES organization(id),
  format_id TEXT NOT NULL,
  config JSONB NOT NULL, -- Format-specific settings
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ
);
```

### payroll_wage_type_mapping

```sql
CREATE TABLE payroll_wage_type_mapping (
  id UUID PRIMARY KEY,
  config_id UUID REFERENCES payroll_export_config(id),
  work_category_id UUID REFERENCES work_category(id),
  absence_category_id UUID REFERENCES absence_category(id),
  special_category TEXT, -- 'overtime', 'holiday_compensation', etc.

  -- Format-specific wage type codes
  datev_wage_type_code TEXT,
  datev_wage_type_name TEXT,
  lexware_wage_type_code TEXT,
  lexware_wage_type_name TEXT,
  sage_wage_type_code TEXT,
  sage_wage_type_name TEXT,

  factor DECIMAL(4,2) DEFAULT 1.00,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ
);
```

### payroll_export_job

```sql
CREATE TABLE payroll_export_job (
  id UUID PRIMARY KEY,
  organization_id TEXT REFERENCES organization(id),
  config_id UUID REFERENCES payroll_export_config(id),
  filters JSONB NOT NULL, -- { dateRange, employeeIds, teamIds }
  status TEXT DEFAULT 'pending', -- pending | processing | completed | failed
  file_name TEXT,
  synced_record_count INTEGER, -- For API exports
  failed_record_count INTEGER,
  created_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ
);
```

### payroll_export_sync_record

```sql
CREATE TABLE payroll_export_sync_record (
  id UUID PRIMARY KEY,
  job_id UUID REFERENCES payroll_export_job(id),
  record_type TEXT NOT NULL, -- 'attendance' | 'absence'
  source_record_id UUID NOT NULL,
  employee_id UUID NOT NULL,
  status TEXT NOT NULL, -- 'pending' | 'synced' | 'failed' | 'skipped'
  external_id TEXT, -- ID from Personio/external system
  error_message TEXT,
  is_retryable BOOLEAN DEFAULT true,
  attempt_count INTEGER DEFAULT 0,
  synced_at TIMESTAMPTZ
);
```
