---
title: Technical Documentation
description: Technical information for developers working on the Z8 project
---

This document contains technical information for developers working on the Z8 project.

## Architecture

Z8 is built as a **Turborepo monorepo**, managing shared logic and various application targets:

| App | Path | Description |
|-----|------|-------------|
| **Web** | `apps/webapp` | Next.js web application - The primary administrative and employee interface. |
| **Mobile** | `apps/mobile` | Expo React Native app - Native mobile companion for time tracking on the go. |
| **Desktop** | `apps/desktop` | Tauri desktop app - Lightweight background widget for quick clock in/out operations. |
| **Docs** | `apps/docs` | Fumadocs documentation site - Technical and user documentation. |

### Tech Stack Highlights
- **Framework**: Next.js 16 (Web), Expo/React Native (Mobile), Tauri (Desktop), Fumadocs (Docs)
- **Language**: TypeScript, Rust (Tauri Core)
- **Database**: Drizzle ORM with PostgreSQL
- **Auth**: Better-Auth (2FA, Passkeys, Social OAuth)
- **Styling**: Tailwind CSS v4, Shadcn UI
- **State Management**: Effect-TS for services
- **Date/Time**: Luxon DateTime
- **Monorepo Tooling**: Turborepo, Bun

### Service Architecture

The application uses **Effect-TS** for building type-safe, composable services:

```
src/lib/services/
├── analytics-service.ts    # Team performance, metrics
├── audit-service.ts        # Audit logging
├── blockchain-service.ts   # GoBD compliance, hash verification
├── email-service.ts        # Email rendering and delivery
├── manager-service.ts      # Manager operations
├── notification-service.ts # Multi-channel notifications
├── onboarding-service.ts   # User onboarding flow
├── permissions-service.ts  # RBAC permissions
├── reporting-service.ts    # Report generation
└── work-schedule-service.ts # Schedule management
```

---

## Getting Started

### Prerequisites
- [Bun](https://bun.sh/) runtime (recommended) or Node.js with pnpm.

### Development Workflow

```bash
# Install dependencies
bun install

# Run all apps in development mode
bun dev

# Run specific app
bun dev --filter=webapp
```

### Infrastructure & Configuration

#### Authentication
Generate auth schema:
```bash
bunx --bun @better-auth/cli generate --output ./src/db/schema.ts
```

Generate auth secret:
```bash
bunx @better-auth/cli@latest secret
```

#### Push Notifications
Generate VAPID keys for push notifications:
```bash
bunx web-push generate-vapid-keys
```

Add these to your `.env` file:
```ini
VAPID_PUBLIC_KEY=<generated-public-key>
VAPID_PRIVATE_KEY=<generated-private-key>
VAPID_SUBJECT=mailto:support@yourdomain.com
```

---

## Code Quality Standards

This project follows strict quality standards enforced by **Ultracite** (Biome preset).

- **Format code**: `npx ultracite fix`
- **Check for issues**: `npx ultracite check`
- **Type checking**: `bun x tsc --noEmit` (in respective app folders)

For more details, see the internal Ultracite Code Standards documentation.

---

## Database Schema

### Core Tables

The database uses Drizzle ORM with the following key entities:

- **users** - Authentication and user accounts
- **employees** - Employee profiles linked to users
- **organizations** - Multi-tenant organization support
- **teams** - Team structure and membership
- **locations** - Physical work locations
- **time_entries** - Clock in/out records
- **absences** - Vacation and time-off requests
- **holidays** - Public and custom holidays
- **holiday_presets** - Reusable holiday collections
- **vacation_assignments** - Flexible vacation allocation rules
- **notifications** - Multi-channel notification records
- **push_subscriptions** - Browser push notification subscriptions
- **audit_logs** - Comprehensive audit trail

### Schema Generation

```bash
# Generate Better-Auth schema
bunx --bun @better-auth/cli generate --output ./src/db/schema.ts

# Run database migrations
bun db:migrate
```

---

## Authentication

### Better-Auth Integration

Z8 uses Better-Auth for authentication with support for:

- **Email/Password**: Traditional authentication
- **Two-Factor Authentication (2FA)**: TOTP-based
- **Passkeys**: WebAuthn/FIDO2 passwordless authentication
- **Social OAuth**: Google, Microsoft, GitHub providers

### Configuration

```bash
# Generate auth secret
bunx @better-auth/cli@latest secret
```

Add to `.env`:
```ini
BETTER_AUTH_SECRET=<generated-secret>
BETTER_AUTH_URL=http://localhost:3000
```

### Social OAuth Setup

Configure OAuth providers in `src/lib/auth/index.ts`:
- Google OAuth credentials
- Microsoft Azure AD
- GitHub OAuth App

---

## Notification System

### Multi-Channel Architecture

The notification system supports three delivery channels:

1. **Email** - Transactional emails via SMTP or provider
2. **Push** - Browser push notifications (Web Push API)
3. **In-App** - Real-time via Server-Sent Events (SSE)

### Push Notifications

Generate VAPID keys:
```bash
bunx web-push generate-vapid-keys
```

Environment configuration:
```ini
VAPID_PUBLIC_KEY=<generated-public-key>
VAPID_PRIVATE_KEY=<generated-private-key>
VAPID_SUBJECT=mailto:support@yourdomain.com
```

### SSE Implementation

Real-time notifications use Server-Sent Events:
- Endpoint: `/api/notifications/sse`
- Auto-reconnection on disconnect
- Event types: `notification`, `status`, `heartbeat`

---

## Blockchain Verification

### GoBD Compliance

Time entries are secured using blockchain-style hashing for GoBD (German record-keeping) compliance:

- Each time entry receives a SHA-256 hash
- Hashes chain together for tamper detection
- Full audit trail with integrity verification

### Hash Calculation

```typescript
import { calculateBlockchainHash } from '@/lib/blockchain';

const hash = calculateBlockchainHash({
  previousHash: entry.previousHash,
  timestamp: entry.createdAt,
  data: entry.data,
});
```

### Validation

```typescript
import { validateBlockchainIntegrity } from '@/lib/blockchain';

const isValid = await validateBlockchainIntegrity(entries);
```

---

## Storage Infrastructure

### TUS Resumable Uploads

File uploads use the TUS protocol for reliable, resumable uploads:

- Large file support with chunking
- Resume interrupted uploads
- Progress tracking

### S3 Integration

Configure S3-compatible storage:

```ini
S3_BUCKET=your-bucket
S3_REGION=eu-central-1
S3_ACCESS_KEY_ID=<access-key>
S3_SECRET_ACCESS_KEY=<secret-key>
S3_ENDPOINT=https://s3.amazonaws.com  # Or compatible endpoint
```

---

## Background Jobs

### Cron Jobs

Background jobs are handled via cron endpoints:

| Job | Schedule | Description |
|-----|----------|-------------|
| `/api/cron/reminders` | Daily | Clock in/out reminders |
| `/api/cron/reports` | Weekly | Scheduled report generation |
| `/api/cron/cleanup` | Daily | Cleanup expired data |
| `/api/cron/export` | On-demand | Data export processing |

### Job Processing

Jobs are processed via the export processor:
```typescript
import { processExportJob } from '@/lib/jobs/export-processor';
```

---

## DateTime Handling

### Luxon Integration

All date/time operations use Luxon for timezone-aware handling:

```typescript
import { DateTime } from 'luxon';

// Create with timezone
const dt = DateTime.now().setZone('Europe/Berlin');

// Format for display
dt.toFormat('dd.MM.yyyy HH:mm');

// ISO format for API
dt.toISO();
```

### Utilities

Custom utilities in `src/lib/datetime/`:
- `toLocalTime()` - Convert to user's timezone
- `toUTC()` - Convert to UTC for storage
- `formatDuration()` - Human-readable duration
- `getWorkingDays()` - Calculate business days

---

## Email Templates

### React Email

Email templates use React Email for consistent styling:

```
src/lib/email/templates/
├── welcome.tsx
├── approval-request.tsx
├── approval-response.tsx
├── time-reminder.tsx
├── export-ready.tsx
└── export-failed.tsx
```

### Rendering

```typescript
import { render } from '@/lib/email/render';
import { WelcomeEmail } from '@/lib/email/templates/welcome';

const html = await render(WelcomeEmail, { name: 'John' });
```

---

## Analytics Service

### Team Performance Metrics

The analytics service provides:

- Work hours by team/employee
- Overtime trends and patterns
- Vacation usage and balance
- Attendance metrics

### API Endpoints

```
GET /api/analytics/team-performance
GET /api/analytics/vacation-trends
GET /api/analytics/work-hours
GET /api/analytics/export
```

---

## Testing

### Unit Tests

Run unit tests:
```bash
bun test
```

Test coverage includes:
- Blockchain validation
- Utility functions
- Notification service
- DateTime operations

### E2E Tests

End-to-end tests use Playwright (when configured):
```bash
bun test:e2e
```

---

## Deployment

### Environment Variables

Required environment variables:

```ini
# Database
DATABASE_URL=postgresql://user:pass@host:5432/db

# Authentication
BETTER_AUTH_SECRET=<secret>
BETTER_AUTH_URL=https://yourdomain.com

# Push Notifications
VAPID_PUBLIC_KEY=<key>
VAPID_PRIVATE_KEY=<key>
VAPID_SUBJECT=mailto:support@yourdomain.com

# Storage (optional)
S3_BUCKET=<bucket>
S3_REGION=<region>
S3_ACCESS_KEY_ID=<key>
S3_SECRET_ACCESS_KEY=<secret>
```

### Health Checks

Health check endpoints for orchestration:

- `GET /api/health` - Overall health
- `GET /api/health/db` - Database connectivity
- `GET /api/health/ready` - Readiness probe

---

## License

Z8 is licensed under a modified BSD 3-Clause license. See the LICENSE file and the open source licenses viewer at `/settings/licenses` for third-party attributions.
